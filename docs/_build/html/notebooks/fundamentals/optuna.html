
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Model Tuning with Optuna &#8212; 𝗜𝗻𝗲𝗳𝗳𝗶𝗰𝗶𝗲𝗻𝘁 𝗡𝗲𝘁𝘄𝗼𝗿𝗸𝘀</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/pone.0237978.g001.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Handling Missing Values" href="missing.html" />
    <link rel="prev" title="Blending and Stacking" href="blending-stacking.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/pone.0237978.g001.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">𝗜𝗻𝗲𝗳𝗳𝗶𝗰𝗶𝗲𝗻𝘁 𝗡𝗲𝘁𝘄𝗼𝗿𝗸𝘀</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  FUNDAMENTALS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="house-prices.html">
   Pipelines in
   <code class="docutils literal notranslate">
    <span class="pre">
     scikit-learn
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="blending-stacking.html">
   Blending and Stacking
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Model Tuning with Optuna
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="missing.html">
   Handling Missing Values
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DEEP LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="backpropagation.html">
   Backpropagation on DAGs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/01-tensorflow-nn.html">
   TensorFlow Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/02-tensorflow-mechanics.html">
   Mechanics of TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/03-tensorflow-activations.html">
   Activation Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tensorflow/04-tensorflow-optim-init.html">
   Initialization and Optimization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODEL DEPLOYMENT
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../deployment/production-code.html">
   Packaging Production Code
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/fundamentals/optuna.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/particle1331/inefficient-networks"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/particle1331/inefficient-networks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/fundamentals/optuna.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/particle1331/inefficient-networks/master?urlpath=tree/docs/notebooks/fundamentals/optuna.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basics-with-scikit-learn">
   Basics with
   <code class="docutils literal notranslate">
    <span class="pre">
     scikit-learn
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fine-tuning-random-forest">
     Fine tuning Random Forest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-algorithms">
     Sampling algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-visualization">
   Results visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neural-networks">
   Neural networks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pruning-trials-based-on-intermediate-values">
     Pruning trials based on intermediate values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-interactions">
     Hyperparameter interactions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-hyperparameters-of-commonly-used-models">
   Appendix: Hyperparameters of commonly used models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost-parameter-space">
     XGBoost parameter space
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Model Tuning with Optuna</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basics-with-scikit-learn">
   Basics with
   <code class="docutils literal notranslate">
    <span class="pre">
     scikit-learn
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fine-tuning-random-forest">
     Fine tuning Random Forest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-algorithms">
     Sampling algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-visualization">
   Results visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neural-networks">
   Neural networks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pruning-trials-based-on-intermediate-values">
     Pruning trials based on intermediate values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-interactions">
     Hyperparameter interactions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-hyperparameters-of-commonly-used-models">
   Appendix: Hyperparameters of commonly used models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost-parameter-space">
     XGBoost parameter space
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="model-tuning-with-optuna">
<h1>Model Tuning with Optuna<a class="headerlink" href="#model-tuning-with-optuna" title="Permalink to this headline">¶</a></h1>
<p><img alt="Status" src="https://img.shields.io/static/v1.svg?label=Status&amp;message=Finished&amp;color=green" /></p>
<p>Hyperparameters are non-learnable parameters of a model that determine its architecture and configuration. Properly tuning
the hyperparameters of a model could mean the difference between convergence to or divergence from a
solution, e.g. choosing the proper learning rate size in a model that trains with gradient descent. In this notebook, we will explore <i><strong>Optuna</strong></i>: an open source hyperparameter optimization framework for automating hyperparameter search.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<ul class="simple">
<li><p><a class="reference external" href="https://optuna.readthedocs.io/en/stable/faq.html">Optuna docs</a></p></li>
<li><p><a class="reference external" href="https://optuna.readthedocs.io/en/stable/index.html">Optuna FAQ</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1907.10902">Optuna paper</a></p></li>
</ul>
</div>
<p>Optuna is a framework agnostic black-box optimizer. This means it only needs a real-valued objective function which returns an evaluation of the hyperparameters and it works with any machine learning or deep learning package such as scikit-learn, PyTorch, and XGBoost. Our main task as developers would be to write a suitable objective function, define the search space, and to interpret results. These correspond to manipulating the <code class="docutils literal notranslate"><span class="pre">study</span></code> and the <code class="docutils literal notranslate"><span class="pre">trial</span></code> objects as we will show in the following section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">optuna</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optuna</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="c1"># Experiment config</span>
<span class="n">RF_NTRIALS</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">VGG_NTRIALS</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">CIFAR10_SAMPLE_RATIO</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">CIFAR10_RESIZE</span> <span class="o">=</span> <span class="mi">32</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.10.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="basics-with-scikit-learn">
<h2>Basics with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code><a class="headerlink" href="#basics-with-scikit-learn" title="Permalink to this headline">¶</a></h2>
<p>The example below should serve as an archetype for all use-cases of Optuna.
Observe that code for defining the search space via the <code class="docutils literal notranslate"><span class="pre">trial</span></code> object can be highly modular:
the user can dynamically construct the search spaces for the hyperparameters within imperative Python code such as conditionals or loops, as well as
define functions as subroutines for handling trials. Even the problem of model selection (choosing between SVM or Random Forest)
is framed as a
hyperparameter optimization problem.
This is in contrast to the <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>
and <code class="docutils literal notranslate"><span class="pre">RandomSearchCV</span></code> APIs in scikit-learn where we had to define the entire
search space before running the search algorithm for a single model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">ensemble</span><span class="p">,</span> <span class="n">svm</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">joblib</span>


<span class="c1"># (1) Define an objective function to be maximized.</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    
    <span class="c1"># (2) Suggest values for the hyperparameters using trial object.</span>
    <span class="n">clf_name</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SVC&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomForest&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">clf_name</span> <span class="o">==</span> <span class="s1">&#39;SVC&#39;</span><span class="p">:</span>
        <span class="n">svc_c</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_loguniform</span><span class="p">(</span><span class="s1">&#39;svc_c&#39;</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">)</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">svc_c</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rf_max_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_loguniform</span><span class="p">(</span><span class="s1">&#39;rf_max_depth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">rf_max_depth</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Always cross-validate!</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># (3) Create a study object and optimize the objective function.</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_breast_cancer</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">[I 2022-01-11 02:08:57,950]</span> A new study created in memory with name: no-name-f6a58395-2e37-4f1c-8a49-d2b3b5f548f9
<span class=" -Color -Color-Green">[I 2022-01-11 02:08:59,460]</span> Trial 0 finished with value: 0.9490607048594939 and parameters: {&#39;classifier&#39;: &#39;RandomForest&#39;, &#39;rf_max_depth&#39;: 4.954837326281144}. Best is trial 0 with value: 0.9490607048594939.
<span class=" -Color -Color-Green">[I 2022-01-11 02:08:59,800]</span> Trial 1 finished with value: 0.6274181027790716 and parameters: {&#39;classifier&#39;: &#39;SVC&#39;, &#39;svc_c&#39;: 25487574.296905443}. Best is trial 0 with value: 0.9490607048594939.
<span class=" -Color -Color-Green">[I 2022-01-11 02:09:00,116]</span> Trial 2 finished with value: 0.947290793355069 and parameters: {&#39;classifier&#39;: &#39;RandomForest&#39;, &#39;rf_max_depth&#39;: 9.635509903646332}. Best is trial 0 with value: 0.9490607048594939.
<span class=" -Color -Color-Green">[I 2022-01-11 02:09:00,158]</span> Trial 3 finished with value: 0.6274181027790716 and parameters: {&#39;classifier&#39;: &#39;SVC&#39;, &#39;svc_c&#39;: 55.036924725442034}. Best is trial 0 with value: 0.9490607048594939.
<span class=" -Color -Color-Green">[I 2022-01-11 02:09:00,181]</span> Trial 4 finished with value: 0.6274181027790716 and parameters: {&#39;classifier&#39;: &#39;SVC&#39;, &#39;svc_c&#39;: 1.509799783930135e-06}. Best is trial 0 with value: 0.9490607048594939.
</pre></div>
</div>
</div>
</div>
<p>The result of each trial can be accessed in the study object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study</span><span class="o">.</span><span class="n">trials_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>number</th>
      <th>value</th>
      <th>datetime_start</th>
      <th>datetime_complete</th>
      <th>duration</th>
      <th>params_classifier</th>
      <th>params_rf_max_depth</th>
      <th>params_svc_c</th>
      <th>state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.949061</td>
      <td>2022-01-09 16:43:23.966991</td>
      <td>2022-01-09 16:43:26.066287</td>
      <td>0 days 00:00:02.099296</td>
      <td>RandomForest</td>
      <td>17.073087</td>
      <td>NaN</td>
      <td>COMPLETE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.954293</td>
      <td>2022-01-09 16:43:26.068106</td>
      <td>2022-01-09 16:43:26.171510</td>
      <td>0 days 00:00:00.103404</td>
      <td>RandomForest</td>
      <td>13.974140</td>
      <td>NaN</td>
      <td>COMPLETE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.627418</td>
      <td>2022-01-09 16:43:26.172781</td>
      <td>2022-01-09 16:43:26.250413</td>
      <td>0 days 00:00:00.077632</td>
      <td>SVC</td>
      <td>NaN</td>
      <td>181956.840415</td>
      <td>COMPLETE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.627418</td>
      <td>2022-01-09 16:43:26.251880</td>
      <td>2022-01-09 16:43:26.329750</td>
      <td>0 days 00:00:00.077870</td>
      <td>SVC</td>
      <td>NaN</td>
      <td>864898.418437</td>
      <td>COMPLETE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.961357</td>
      <td>2022-01-09 16:43:26.331104</td>
      <td>2022-01-09 16:43:26.432237</td>
      <td>0 days 00:00:00.101133</td>
      <td>RandomForest</td>
      <td>9.727522</td>
      <td>NaN</td>
      <td>COMPLETE</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="fine-tuning-random-forest">
<h3>Fine tuning Random Forest<a class="headerlink" href="#fine-tuning-random-forest" title="Permalink to this headline">¶</a></h3>
<p>Here we focus on tuning a single Random Forest model. Then, plot the accuracy for each pair of hyperparameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
    <span class="n">max_features</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;max_features&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">])</span>
    
    <span class="n">clf</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">,</span>
        <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>   
    
    <span class="n">score</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>


<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">RF_NTRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">[I 2022-01-09 16:43:26,890]</span> A new study created in memory with name: no-name-115a68d2-ab3d-4fb7-863e-40264b640ac5
<span class=" -Color -Color-Green">[I 2022-01-09 16:43:31,170]</span> Trial 0 finished with value: 0.9666356155876418 and parameters: {&#39;max_depth&#39;: 70, &#39;max_features&#39;: 0.4553140329238048, &#39;n_estimators&#39;: 353, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:43:33,757]</span> Trial 1 finished with value: 0.9490607048594939 and parameters: {&#39;max_depth&#39;: 2, &#39;max_features&#39;: 0.8793554962469481, &#39;n_estimators&#39;: 217, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:43:46,501]</span> Trial 2 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 112, &#39;max_features&#39;: 0.8957261207990624, &#39;n_estimators&#39;: 679, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:43:51,862]</span> Trial 3 finished with value: 0.95960254618848 and parameters: {&#39;max_depth&#39;: 52, &#39;max_features&#39;: 0.131096167102392, &#39;n_estimators&#39;: 688, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:43:52,930]</span> Trial 4 finished with value: 0.9543393882937432 and parameters: {&#39;max_depth&#39;: 89, &#39;max_features&#39;: 0.19757680095203894, &#39;n_estimators&#39;: 123, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:04,891]</span> Trial 5 finished with value: 0.9596180717279925 and parameters: {&#39;max_depth&#39;: 43, &#39;max_features&#39;: 0.745646516579023, &#39;n_estimators&#39;: 799, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:05,977]</span> Trial 6 finished with value: 0.9455364073901567 and parameters: {&#39;max_depth&#39;: 2, &#39;max_features&#39;: 0.4305160160128184, &#39;n_estimators&#39;: 120, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:10,074]</span> Trial 7 finished with value: 0.9525694767893184 and parameters: {&#39;max_depth&#39;: 2, &#39;max_features&#39;: 0.5896358956701836, &#39;n_estimators&#39;: 395, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:11,713]</span> Trial 8 finished with value: 0.9648657040832168 and parameters: {&#39;max_depth&#39;: 8, &#39;max_features&#39;: 0.2725360621622547, &#39;n_estimators&#39;: 107, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:13,789]</span> Trial 9 finished with value: 0.9631268436578171 and parameters: {&#39;max_depth&#39;: 17, &#39;max_features&#39;: 0.42336296524868955, &#39;n_estimators&#39;: 186, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 0 with value: 0.9666356155876418.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:19,421]</span> Trial 10 finished with value: 0.9683900015525542 and parameters: {&#39;max_depth&#39;: 17, &#39;max_features&#39;: 0.6271061861322312, &#39;n_estimators&#39;: 390, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:24,714]</span> Trial 11 finished with value: 0.9666200900481291 and parameters: {&#39;max_depth&#39;: 15, &#39;max_features&#39;: 0.5822621323950136, &#39;n_estimators&#39;: 383, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:30,752]</span> Trial 12 finished with value: 0.9631113181183046 and parameters: {&#39;max_depth&#39;: 7, &#39;max_features&#39;: 0.6914246020496978, &#39;n_estimators&#39;: 394, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:34,208]</span> Trial 13 finished with value: 0.9666356155876418 and parameters: {&#39;max_depth&#39;: 31, &#39;max_features&#39;: 0.4008483203477205, &#39;n_estimators&#39;: 295, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:42,058]</span> Trial 14 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 5, &#39;max_features&#39;: 0.697074880558194, &#39;n_estimators&#39;: 515, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:46,095]</span> Trial 15 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 25, &#39;max_features&#39;: 0.4911415937971424, &#39;n_estimators&#39;: 266, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:48,194]</span> Trial 16 finished with value: 0.9666200900481291 and parameters: {&#39;max_depth&#39;: 23, &#39;max_features&#39;: 0.29947419424183597, &#39;n_estimators&#39;: 207, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:51,542]</span> Trial 17 finished with value: 0.9648812296227295 and parameters: {&#39;max_depth&#39;: 9, &#39;max_features&#39;: 0.5232400508998625, &#39;n_estimators&#39;: 259, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:44:54,420]</span> Trial 18 finished with value: 0.9666356155876418 and parameters: {&#39;max_depth&#39;: 4, &#39;max_features&#39;: 0.7925469586846491, &#39;n_estimators&#39;: 158, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:03,962]</span> Trial 19 finished with value: 0.9648657040832168 and parameters: {&#39;max_depth&#39;: 26, &#39;max_features&#39;: 0.9916274673184882, &#39;n_estimators&#39;: 504, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:08,247]</span> Trial 20 finished with value: 0.9683900015525542 and parameters: {&#39;max_depth&#39;: 11, &#39;max_features&#39;: 0.6494072971899049, &#39;n_estimators&#39;: 282, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:12,318]</span> Trial 21 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 12, &#39;max_features&#39;: 0.6177131689895455, &#39;n_estimators&#39;: 281, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:17,211]</span> Trial 22 finished with value: 0.9666356155876418 and parameters: {&#39;max_depth&#39;: 18, &#39;max_features&#39;: 0.5182258148253241, &#39;n_estimators&#39;: 307, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:24,171]</span> Trial 23 finished with value: 0.9666356155876418 and parameters: {&#39;max_depth&#39;: 37, &#39;max_features&#39;: 0.6435668892225698, &#39;n_estimators&#39;: 483, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:27,362]</span> Trial 24 finished with value: 0.9683744760130415 and parameters: {&#39;max_depth&#39;: 11, &#39;max_features&#39;: 0.35658896664659767, &#39;n_estimators&#39;: 262, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:30,324]</span> Trial 25 finished with value: 0.9631268436578171 and parameters: {&#39;max_depth&#39;: 4, &#39;max_features&#39;: 0.5129171273311892, &#39;n_estimators&#39;: 233, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:32,922]</span> Trial 26 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 23, &#39;max_features&#39;: 0.778630164750195, &#39;n_estimators&#39;: 161, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:35,628]</span> Trial 27 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 6, &#39;max_features&#39;: 0.8630561237098009, &#39;n_estimators&#39;: 160, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:40,807]</span> Trial 28 finished with value: 0.9613569321533924 and parameters: {&#39;max_depth&#39;: 60, &#39;max_features&#39;: 0.6694356886834675, &#39;n_estimators&#39;: 329, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:43,343]</span> Trial 29 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 12, &#39;max_features&#39;: 0.7888952063202767, &#39;n_estimators&#39;: 156, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:51,958]</span> Trial 30 finished with value: 0.9666200900481291 and parameters: {&#39;max_depth&#39;: 10, &#39;max_features&#39;: 0.8231032780230729, &#39;n_estimators&#39;: 466, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:57,365]</span> Trial 31 finished with value: 0.9631113181183046 and parameters: {&#39;max_depth&#39;: 24, &#39;max_features&#39;: 0.7211108291204642, &#39;n_estimators&#39;: 347, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:45:59,919]</span> Trial 32 finished with value: 0.9648812296227295 and parameters: {&#39;max_depth&#39;: 14, &#39;max_features&#39;: 0.46511497343641706, &#39;n_estimators&#39;: 185, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:02,532]</span> Trial 33 finished with value: 0.9631113181183046 and parameters: {&#39;max_depth&#39;: 20, &#39;max_features&#39;: 0.964559544639612, &#39;n_estimators&#39;: 144, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:04,800]</span> Trial 34 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 38, &#39;max_features&#39;: 0.7857210353437216, &#39;n_estimators&#39;: 139, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:07,063]</span> Trial 35 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 75, &#39;max_features&#39;: 0.895797389597036, &#39;n_estimators&#39;: 130, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:09,979]</span> Trial 36 finished with value: 0.9561248253376805 and parameters: {&#39;max_depth&#39;: 13, &#39;max_features&#39;: 0.7649210639345877, &#39;n_estimators&#39;: 181, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:20,083]</span> Trial 37 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 44, &#39;max_features&#39;: 0.8414076312474784, &#39;n_estimators&#39;: 586, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:22,673]</span> Trial 38 finished with value: 0.959633597267505 and parameters: {&#39;max_depth&#39;: 31, &#39;max_features&#39;: 0.9157629156491569, &#39;n_estimators&#39;: 112, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:25,901]</span> Trial 39 finished with value: 0.9631113181183046 and parameters: {&#39;max_depth&#39;: 90, &#39;max_features&#39;: 0.5920529250625748, &#39;n_estimators&#39;: 234, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:28,403]</span> Trial 40 finished with value: 0.9578636857630801 and parameters: {&#39;max_depth&#39;: 50, &#39;max_features&#39;: 0.4783828410020865, &#39;n_estimators&#39;: 210, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:30,639]</span> Trial 41 finished with value: 0.9666200900481293 and parameters: {&#39;max_depth&#39;: 35, &#39;max_features&#39;: 0.7619950855295334, &#39;n_estimators&#39;: 140, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:33,715]</span> Trial 42 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 18, &#39;max_features&#39;: 0.8225784733771202, &#39;n_estimators&#39;: 165, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:39,850]</span> Trial 43 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 8, &#39;max_features&#39;: 0.6383086887951374, &#39;n_estimators&#39;: 424, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:41,282]</span> Trial 44 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 15, &#39;max_features&#39;: 0.5614932520792806, &#39;n_estimators&#39;: 105, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:43,221]</span> Trial 45 finished with value: 0.95960254618848 and parameters: {&#39;max_depth&#39;: 16, &#39;max_features&#39;: 0.5770286382877312, &#39;n_estimators&#39;: 116, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:45,250]</span> Trial 46 finished with value: 0.95960254618848 and parameters: {&#39;max_depth&#39;: 21, &#39;max_features&#39;: 0.7212775690363596, &#39;n_estimators&#39;: 132, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:46,616]</span> Trial 47 finished with value: 0.959633597267505 and parameters: {&#39;max_depth&#39;: 6, &#39;max_features&#39;: 0.6562034355804018, &#39;n_estimators&#39;: 100, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:48,092]</span> Trial 48 finished with value: 0.9578481602235677 and parameters: {&#39;max_depth&#39;: 10, &#39;max_features&#39;: 0.568523166767695, &#39;n_estimators&#39;: 106, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:46:49,911]</span> Trial 49 finished with value: 0.9630957925787922 and parameters: {&#39;max_depth&#39;: 112, &#39;max_features&#39;: 0.699359173921984, &#39;n_estimators&#39;: 121, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:00,045]</span> Trial 50 finished with value: 0.9578326346840553 and parameters: {&#39;max_depth&#39;: 3, &#39;max_features&#39;: 0.5481122335205243, &#39;n_estimators&#39;: 752, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:02,972]</span> Trial 51 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 27, &#39;max_features&#39;: 0.39001770767458754, &#39;n_estimators&#39;: 253, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:07,331]</span> Trial 52 finished with value: 0.9666200900481291 and parameters: {&#39;max_depth&#39;: 14, &#39;max_features&#39;: 0.3665759432560646, &#39;n_estimators&#39;: 370, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:09,647]</span> Trial 53 finished with value: 0.9666200900481293 and parameters: {&#39;max_depth&#39;: 12, &#39;max_features&#39;: 0.7502318513015229, &#39;n_estimators&#39;: 147, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:13,113]</span> Trial 54 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 29, &#39;max_features&#39;: 0.11090149242752717, &#39;n_estimators&#39;: 425, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:18,247]</span> Trial 55 finished with value: 0.9648657040832169 and parameters: {&#39;max_depth&#39;: 16, &#39;max_features&#39;: 0.6231007776650471, &#39;n_estimators&#39;: 323, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:20,473]</span> Trial 56 finished with value: 0.9648657040832168 and parameters: {&#39;max_depth&#39;: 22, &#39;max_features&#39;: 0.20795797506889363, &#39;n_estimators&#39;: 236, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:23,328]</span> Trial 57 finished with value: 0.9596180717279925 and parameters: {&#39;max_depth&#39;: 38, &#39;max_features&#39;: 0.6780950529433282, &#39;n_estimators&#39;: 200, &#39;criterion&#39;: &#39;gini&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:26,805]</span> Trial 58 finished with value: 0.968390001552554 and parameters: {&#39;max_depth&#39;: 7, &#39;max_features&#39;: 0.7932031603255675, &#39;n_estimators&#39;: 169, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 10 with value: 0.9683900015525542.
<span class=" -Color -Color-Green">[I 2022-01-09 16:47:33,794]</span> Trial 59 finished with value: 0.9701443875174661 and parameters: {&#39;max_depth&#39;: 28, &#39;max_features&#39;: 0.4278318142755836, &#39;n_estimators&#39;: 596, &#39;criterion&#39;: &#39;entropy&#39;}. Best is trial 59 with value: 0.9701443875174661.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;max_depth&#39;: 28,
 &#39;max_features&#39;: 0.4278318142755836,
 &#39;n_estimators&#39;: 596,
 &#39;criterion&#39;: &#39;entropy&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9701443875174661
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sampling-algorithms">
<h3>Sampling algorithms<a class="headerlink" href="#sampling-algorithms" title="Permalink to this headline">¶</a></h3>
<p>Optuna uses  <strong>Tree-structured Parzen Estimater</strong> (<strong>TPE</strong>) <span id="id1">[<a class="reference internal" href="../../intro.html#id11">BBBK11</a>]</span> as the default sampler which is a form of Bayesian optimization. Observe that the hyperparameter space is searched more efficiently than random search with the sampler choosing points closer to previous good results. Samplers are specified when creating a study:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">())</span>
</pre></div>
</div>
<p>TPE samples every hyperparameter independently. From the <a class="reference external" href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.samplers.TPESampler.html#optuna.samplers.TPESampler">docs</a>:</p>
<blockquote>
<div><p>On each trial, for each parameter, TPE fits one Gaussian Mixture Model (GMM) <code class="docutils literal notranslate"><span class="pre">l(x)</span></code> to the set of parameter values associated with the best objective values, and another GMM <code class="docutils literal notranslate"><span class="pre">g(x)</span></code> to the remaining parameter values. It chooses the parameter value <code class="docutils literal notranslate"><span class="pre">x</span></code> that maximizes the ratio <code class="docutils literal notranslate"><span class="pre">l(x)/g(x)</span></code>.</p>
</div></blockquote>
<p>The following plot shows the difference between TPE with grid and random sampling:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
    <span class="n">study</span><span class="o">.</span><span class="n">trials_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">),</span> 
        <span class="n">colorbar</span><span class="o">=</span><span class="n">cb</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">plot_results</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="s1">&#39;params_max_depth&#39;</span><span class="p">,</span>    <span class="s1">&#39;params_n_estimators&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plot_results</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="s1">&#39;params_max_depth&#39;</span><span class="p">,</span>    <span class="s1">&#39;params_max_features&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plot_results</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="s1">&#39;params_n_estimators&#39;</span><span class="p">,</span> <span class="s1">&#39;params_max_features&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/optuna_19_0.png" src="../../_images/optuna_19_0.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\( \)</span></p>
<div class="figure align-default" id="optuna-samplers">
<img alt="../../_images/optuna-samplers.png" src="../../_images/optuna-samplers.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">List of all <a class="reference external" href="https://optuna.readthedocs.io/en/stable/reference/samplers.html">sampling algorithms</a> as of version 2.10.0.</span><a class="headerlink" href="#optuna-samplers" title="Permalink to this image">¶</a></p>
</div>
<p>Another sampling algorithm implemented is <strong>Covariance Matrix Adaptation Evolution Strategy</strong> (<strong>CMA-ES</strong>) <span id="id2">[<a class="reference internal" href="../../intro.html#id3">Han16</a>]</span>. This algorithm is designed to tackle ill-conditioned, non-separable problems, i.e. cannot be solved by solving several 1-dimensional problems. CMA-ES is typically implemented along with TPE whenever the former algorithm is not applicable, e.g. for searching dynamically constructed hyperparameters (as CMA-ES requires that parameters are specified statically prior to the optimization) or for searching categorical parameters, as CMA-ES is designed to search real parameters on a continuous domain. TPE + CMA-ES sampling can be implemented as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">CmaEsSampler</span><span class="p">(</span>
    <span class="n">warn_independent_sampling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">independent_sampler</span><span class="o">=</span><span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Results from the paper <span id="id3">[<a class="reference internal" href="../../intro.html#id5">ASY+19</a>]</span> show that TPE + CMA-ES works better than counterparts of the same time complexity:</p>
<div class="figure align-default" id="fig9-optuna">
<a class="reference internal image-reference" href="../../_images/fig9-optuna.png"><img alt="../../_images/fig9-optuna.png" src="../../_images/fig9-optuna.png" style="width: 35em;" /></a>
</div>
<div class="figure align-default" id="fig10-optuna">
<a class="reference internal image-reference" href="../../_images/fig10-optuna.png"><img alt="../../_images/fig10-optuna.png" src="../../_images/fig10-optuna.png" style="width: 35em;" /></a>
</div>
</div>
</div>
<div class="section" id="results-visualization">
<h2>Results visualization<a class="headerlink" href="#results-visualization" title="Permalink to this headline">¶</a></h2>
<p><strong>History.</strong> Optuna provides visualization functions in the <code class="docutils literal notranslate"><span class="pre">optuna.visualization</span></code> library<a class="footnote-reference brackets" href="#ref4" id="id4">1</a>. The following plot shows the best objective value found as the trials progress. The increasing trend in accuracy indicates that the TPE sampler is working well, i.e. the search algorithm learns from previous trials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-1">
<img alt="../../_images/optuna-1.png" src="../../_images/optuna-1.png" />
</div>
<p><strong>Parallel coordinate plot.</strong> The parallel coordinate plot gives us a feel of how the hyperparameters interact. To isolate subsets of lines, we can use the interactive capabilities of the plots by dragging on each axis to restrict it. The resulting purple bars can be disjoint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_parallel_coordinate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-2">
<img alt="../../_images/optuna-2.png" src="../../_images/optuna-2.png" />
</div>
<p><strong>Slice plots.</strong> Slice plots show the projections of the sampler’s path in the hyperparameter space in each individual dimension, then shifts each point along the vertical axis based on the its objective value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-3">
<img alt="../../_images/optuna-3.png" src="../../_images/optuna-3.png" />
</div>
<p><strong>Hyperparameter importance.</strong> The default importance evaluator in Optuna is <code class="docutils literal notranslate"><span class="pre">FanovaImportanceEvaluator</span></code>. This takes as input performance data gathered with different hyperparameter settings of the algorithm, fits a random forest to capture the relationship between hyperparameters and performance, and then applies functional ANOVA to assess how important each of the hyperparameters and each low-order interaction of hyperparameters is to performance <span id="id5">[<a class="reference internal" href="../../intro.html#id2">HHLB14</a>]</span>. From the <a class="reference external" href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.importance.FanovaImportanceEvaluator.html">docs</a>:</p>
<blockquote>
<div><p>The performance of fANOVA depends on the prediction performance of the underlying random forest model. In order to obtain high prediction performance, it is necessary to cover a wide range of the hyperparameter search space. It is recommended to use an exploration-oriented sampler such as <code class="docutils literal notranslate"><span class="pre">RandomSampler</span></code>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">350</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-4">
<a class="reference internal image-reference" href="../../_images/optuna-4.png"><img alt="../../_images/optuna-4.png" src="../../_images/optuna-4.png" style="width: 539.0px; height: 284.0px;" /></a>
</div>
<p><strong>Contour plots.</strong> To visualize interactions between any pair of hyperparameters spatially, we can generate contour plots where regions of <em>low</em> objective value are darker in color.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;criterion&quot;</span><span class="p">,</span> <span class="s2">&quot;n_estimators&quot;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-5">
<a class="reference internal image-reference" href="../../_images/optuna-5.png"><img alt="../../_images/optuna-5.png" src="../../_images/optuna-5.png" style="width: 578.0px; height: 445.0px;" /></a>
</div>
</div>
<div class="section" id="neural-networks">
<h2>Neural networks<a class="headerlink" href="#neural-networks" title="Permalink to this headline">¶</a></h2>
<p>As noted above, we should always perform tuning within a cross-validation framework. However, with neural networks, doing 5-fold CV would require too much compute time — hence, too much resources, e.g. GPU usage. Instead, we perform tuning on a hold-out validation set and hope for the best.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">import</span> <span class="nn">torchvision.datasets</span> <span class="k">as</span> <span class="nn">datasets</span>
<span class="kn">from</span> <span class="nn">torch.utils</span> <span class="kn">import</span> <span class="n">data</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">PATIENCE</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">DEVICE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Define a convolutional network with a smaller version of the VGG architecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://d2l.ai/chapter_convolutional-modern/vgg.html</span>

<span class="k">def</span> <span class="nf">vgg_block</span><span class="p">(</span><span class="n">num_convs</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">):</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_convs</span><span class="p">):</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span>
                                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="n">in_channels</span> <span class="o">=</span> <span class="n">out_channels</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">vgg</span><span class="p">(</span><span class="n">conv_arch</span><span class="p">,</span> <span class="n">linear_width</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">in_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">conv_blks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># The convolutional part</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">num_convs</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conv_arch</span><span class="p">:</span>
        <span class="n">conv_blks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vgg_block</span><span class="p">(</span><span class="n">num_convs</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">))</span>
        <span class="n">in_channels</span> <span class="o">=</span> <span class="n">out_channels</span>

    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span>
    <span class="n">dense_layers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">out_channels</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">linear_width</span><span class="p">),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">linear_width</span><span class="p">,</span> <span class="n">linear_width</span><span class="p">),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">linear_width</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">conv_blks</span> <span class="o">+</span> <span class="n">dense_layers</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We also define a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> class for CIFAR-10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform</span> <span class="o">=</span> <span class="p">[</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()]</span>
<span class="k">if</span> <span class="n">CIFAR10_RESIZE</span><span class="p">:</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">CIFAR10_RESIZE</span><span class="p">))</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

<span class="n">mnist_train</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mnist_valid</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_cifar10_dataloaders</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">sample_ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_train</span><span class="p">,</span> 
                                   <span class="n">batch_size</span><span class="p">,</span> 
                                   <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                   <span class="n">sampler</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mnist_train</span><span class="p">)</span><span class="o">*</span><span class="n">sample_ratio</span><span class="p">)))</span>
    
    <span class="n">valid_loader</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_valid</span><span class="p">,</span> 
                                   <span class="n">batch_size</span><span class="p">,</span> 
                                   <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                   <span class="n">sampler</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mnist_valid</span><span class="p">)</span><span class="o">*</span><span class="n">sample_ratio</span><span class="p">)))</span>
    
    <span class="k">return</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">valid_loader</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz to ./cifar-10-python.tar.gz
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f526ee1acb344c17a1fa5c35271c0255", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting ./cifar-10-python.tar.gz to .
Files already downloaded and verified
</pre></div>
</div>
</div>
</div>
<p>Define a trainer for the neural network model. This will handle all loss and metric evaluation, as well as backpropagation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Engine</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Facilitate neural network training and evaluation.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span> 

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Train model on one epoch. Return train loss.&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
            
            <span class="c1"># Forward pass</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            
            <span class="c1"># Backward pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">J</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="c1"># Cumulative loss</span>
            <span class="n">loss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">-</span> <span class="n">loss</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loss</span>


    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return validation loss and validation accuracy.&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                
                <span class="c1"># Forward pass</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Cumulative metrics</span>
                <span class="n">loss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">-</span> <span class="n">loss</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">num_correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">preds</span> <span class="o">==</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">num_samples</span> <span class="o">+=</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">acc</span> <span class="o">=</span> <span class="n">num_correct</span> <span class="o">/</span> <span class="n">num_samples</span>
        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pruning-trials-based-on-intermediate-values">
<h3>Pruning trials based on intermediate values<a class="headerlink" href="#pruning-trials-based-on-intermediate-values" title="Permalink to this headline">¶</a></h3>
<p>Finally, we set up the <code class="docutils literal notranslate"><span class="pre">study</span></code> instance and its objective function. Note that the search space is dynamically constructed depending on the number of layers (i.e. an earlier suggestion for a hyperparameter). During training, we perform early stopping on validation loss. If no new minimum val. loss is found after 5 epochs, then the minimum val. loss is returned as the objective<a class="footnote-reference brackets" href="#ref3" id="id6">2</a>.</p>
<p>Computing intermediate values allow us to <strong>prune</strong> unpromising trials to conserve resources. The default pruner in Optuna is <a class="reference external" href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.pruners.MedianPruner.html"><code class="docutils literal notranslate"><span class="pre">MedianPruner</span></code></a> which prunes a trial if its best intermediate result as of the current step (e.g. current best valid loss) is worse than the median of all intermediate results of previous trials <em>at the current step</em>. Hence, the best intermediate result of a pruned trial is less than the best intermediate result of 1/2 of the other trials as of that step. In our case, if the minimum validation loss does not improve too quickly, then the trial is pruned. Of course, the validation loss could descend rapidly at later steps, but the median pruner does not bet on this happening.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_training</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">valid_loader</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
    <span class="c1"># Run training</span>
    <span class="n">best_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">patience</span> <span class="o">=</span> <span class="n">PATIENCE</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>

        <span class="c1"># Train and validation step</span>
        <span class="n">train_loss</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
        <span class="n">valid_loss</span><span class="p">,</span> <span class="n">valid_acc</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">valid_loader</span><span class="p">)</span>
            
        <span class="c1"># Early stopping</span>
        <span class="k">if</span> <span class="n">valid_loss</span> <span class="o">&lt;</span> <span class="n">best_loss</span><span class="p">:</span>
            <span class="n">best_loss</span> <span class="o">=</span> <span class="n">valid_loss</span>
            <span class="n">patience</span> <span class="o">=</span> <span class="n">PATIENCE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">patience</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">patience</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
    
        <span class="c1"># Pruning unpromising trials</span>
        <span class="n">trial</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">valid_loss</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">should_prune</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">optuna</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">()</span>
            
        <span class="n">loop</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">EPOCHS</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span>
            <span class="n">val_loss</span><span class="o">=</span><span class="n">valid_loss</span><span class="p">,</span> 
            <span class="n">acc</span><span class="o">=</span><span class="n">valid_acc</span><span class="p">,</span> 
            <span class="n">patience</span><span class="o">=</span><span class="n">patience</span><span class="p">,</span>
            <span class="n">lr</span><span class="o">=</span><span class="n">engine</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">param_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lr&#39;</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">best_loss</span>


<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="c1"># Setup model architecture</span>
    <span class="n">conv_arch</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vgg_b1&quot;</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vgg_b2&quot;</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vgg_b3&quot;</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">dense_width</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dropout</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Initialize engine</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">vgg</span><span class="p">(</span><span class="n">conv_arch</span><span class="p">,</span> <span class="n">dense_width</span><span class="p">,</span> <span class="n">dropout</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>    
    <span class="n">engine</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DEVICE</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
    
    <span class="c1"># Initalize data loaders</span>
    <span class="n">train_loader</span><span class="p">,</span> <span class="n">valid_loader</span> <span class="o">=</span> <span class="n">get_cifar10_dataloaders</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">sample_ratio</span><span class="o">=</span><span class="n">CIFAR10_SAMPLE_RATIO</span><span class="p">)</span>
    
    <span class="c1"># Start training run</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">run_training</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">valid_loader</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p>This study looks rather complicated, with a lot of moving parts. We can test the objective using a <code class="docutils literal notranslate"><span class="pre">FixedTrial</span></code> which suggests fixed parameter values based on a given dictionary of parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trial</span> <span class="o">=</span> <span class="n">FixedTrial</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
<span class="n">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span> 
</pre></div>
</div>
<p>Running the minimization problem with <code class="docutils literal notranslate"><span class="pre">MedianPruner</span></code>. The parameters of the pruner will be explained below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">MedianPruner</span><span class="p">(</span><span class="n">n_startup_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_warmup_steps</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_min_trials</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;minimize&quot;</span><span class="p">,</span> <span class="n">pruner</span><span class="o">=</span><span class="n">pruner</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">VGG_NTRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">[I 2022-01-09 16:47:49,141]</span> A new study created in memory with name: no-name-78b4e217-1a91-4764-8134-993f98d3cea7
<span class=" -Color -Color-Green">[I 2022-01-09 16:54:25,197]</span> Trial 0 finished with value: 0.9663325294852255 and parameters: {&#39;vgg_b1&#39;: 310, &#39;vgg_b2&#39;: 162, &#39;vgg_b3&#39;: 289, &#39;dense&#39;: 598, &#39;dropout&#39;: 0.1, &#39;lr&#39;: 5.8571334191863526e-05, &#39;batch_size&#39;: 124}. Best is trial 0 with value: 0.9663325294852255.
<span class=" -Color -Color-Green">[I 2022-01-09 17:01:53,776]</span> Trial 1 finished with value: 0.8538003005400426 and parameters: {&#39;vgg_b1&#39;: 258, &#39;vgg_b2&#39;: 247, &#39;vgg_b3&#39;: 206, &#39;dense&#39;: 402, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 5.986375901071346e-05, &#39;batch_size&#39;: 42}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:06:12,651]</span> Trial 2 finished with value: 0.9333370736837385 and parameters: {&#39;vgg_b1&#39;: 249, &#39;vgg_b2&#39;: 160, &#39;vgg_b3&#39;: 291, &#39;dense&#39;: 960, &#39;dropout&#39;: 0.5, &#39;lr&#39;: 9.652575464574833e-05, &#39;batch_size&#39;: 20}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:07:29,117]</span> Trial 3 finished with value: 2.308023227112635 and parameters: {&#39;vgg_b1&#39;: 217, &#39;vgg_b2&#39;: 198, &#39;vgg_b3&#39;: 232, &#39;dense&#39;: 508, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 0.09329797140131525, &#39;batch_size&#39;: 89}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:12:05,098]</span> Trial 4 finished with value: 0.9594035801822195 and parameters: {&#39;vgg_b1&#39;: 372, &#39;vgg_b2&#39;: 468, &#39;vgg_b3&#39;: 230, &#39;dense&#39;: 733, &#39;dropout&#39;: 0.2, &#39;lr&#39;: 0.00010174140869152476, &#39;batch_size&#39;: 68}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:15:52,590]</span> Trial 5 finished with value: 2.3308440674943625 and parameters: {&#39;vgg_b1&#39;: 463, &#39;vgg_b2&#39;: 429, &#39;vgg_b3&#39;: 234, &#39;dense&#39;: 665, &#39;dropout&#39;: 0.30000000000000004, &#39;lr&#39;: 0.13353412052488867, &#39;batch_size&#39;: 18}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:17:23,245]</span> Trial 6 finished with value: 2.304749325097323 and parameters: {&#39;vgg_b1&#39;: 208, &#39;vgg_b2&#39;: 216, &#39;vgg_b3&#39;: 346, &#39;dense&#39;: 391, &#39;dropout&#39;: 0.8, &#39;lr&#39;: 0.013848177485291456, &#39;batch_size&#39;: 30}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:27:29,422]</span> Trial 7 finished with value: 0.9173180745775198 and parameters: {&#39;vgg_b1&#39;: 370, &#39;vgg_b2&#39;: 351, &#39;vgg_b3&#39;: 285, &#39;dense&#39;: 648, &#39;dropout&#39;: 0.30000000000000004, &#39;lr&#39;: 1.9999878982282223e-05, &#39;batch_size&#39;: 17}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:48:59,758]</span> Trial 8 finished with value: 0.970559313589213 and parameters: {&#39;vgg_b1&#39;: 399, &#39;vgg_b2&#39;: 223, &#39;vgg_b3&#39;: 308, &#39;dense&#39;: 259, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 1.3064656747928878e-05, &#39;batch_size&#39;: 51}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:50:51,638]</span> Trial 9 finished with value: 2.1159408791311862 and parameters: {&#39;vgg_b1&#39;: 506, &#39;vgg_b2&#39;: 277, &#39;vgg_b3&#39;: 336, &#39;dense&#39;: 355, &#39;dropout&#39;: 0.6, &#39;lr&#39;: 0.01014034214456914, &#39;batch_size&#39;: 85}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 17:52:17,641]</span> Trial 10 finished with value: 2.3026118452185833 and parameters: {&#39;vgg_b1&#39;: 137, &#39;vgg_b2&#39;: 292, &#39;vgg_b3&#39;: 151, &#39;dense&#39;: 404, &#39;dropout&#39;: 1.0, &#39;lr&#39;: 0.0007539244254643046, &#39;batch_size&#39;: 33}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:08:07,878]</span> Trial 11 finished with value: 0.8779827433663444 and parameters: {&#39;vgg_b1&#39;: 314, &#39;vgg_b2&#39;: 358, &#39;vgg_b3&#39;: 464, &#39;dense&#39;: 500, &#39;dropout&#39;: 0.4, &#39;lr&#39;: 1.359546850655156e-05, &#39;batch_size&#39;: 27}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:12:25,817]</span> Trial 12 finished with value: 0.9928599794705705 and parameters: {&#39;vgg_b1&#39;: 286, &#39;vgg_b2&#39;: 351, &#39;vgg_b3&#39;: 510, &#39;dense&#39;: 481, &#39;dropout&#39;: 0.5, &#39;lr&#39;: 0.00030648865735273913, &#39;batch_size&#39;: 32}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:16:12,951]</span> Trial 13 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 18:20:18,070]</span> Trial 14 finished with value: 2.3027173531055456 and parameters: {&#39;vgg_b1&#39;: 307, &#39;vgg_b2&#39;: 136, &#39;vgg_b3&#39;: 484, &#39;dense&#39;: 450, &#39;dropout&#39;: 0.4, &#39;lr&#39;: 0.0019107435528946583, &#39;batch_size&#39;: 25}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:24:20,313]</span> Trial 15 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 18:28:34,995]</span> Trial 16 finished with value: 0.9710360651466702 and parameters: {&#39;vgg_b1&#39;: 183, &#39;vgg_b2&#39;: 392, &#39;vgg_b3&#39;: 417, &#39;dense&#39;: 806, &#39;dropout&#39;: 0.4, &#39;lr&#39;: 0.0004394672803314361, &#39;batch_size&#39;: 23}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:34:13,305]</span> Trial 17 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 18:37:54,311]</span> Trial 18 finished with value: 0.9328236542642117 and parameters: {&#39;vgg_b1&#39;: 339, &#39;vgg_b2&#39;: 318, &#39;vgg_b3&#39;: 139, &#39;dense&#39;: 468, &#39;dropout&#39;: 0.4, &#39;lr&#39;: 0.00024037964468769132, &#39;batch_size&#39;: 39}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:49:09,175]</span> Trial 19 finished with value: 0.8594228555448353 and parameters: {&#39;vgg_b1&#39;: 424, &#39;vgg_b2&#39;: 244, &#39;vgg_b3&#39;: 407, &#39;dense&#39;: 415, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 3.136450432363738e-05, &#39;batch_size&#39;: 26}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 18:54:58,491]</span> Trial 20 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:00:02,795]</span> Trial 21 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:07:12,185]</span> Trial 22 finished with value: 0.9695012574436284 and parameters: {&#39;vgg_b1&#39;: 340, &#39;vgg_b2&#39;: 295, &#39;vgg_b3&#39;: 441, &#39;dense&#39;: 546, &#39;dropout&#39;: 0.8, &#39;lr&#39;: 0.000132589105195643, &#39;batch_size&#39;: 21}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:10:58,123]</span> Trial 23 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:17:36,122]</span> Trial 24 finished with value: 0.8793295427244536 and parameters: {&#39;vgg_b1&#39;: 231, &#39;vgg_b2&#39;: 197, &#39;vgg_b3&#39;: 206, &#39;dense&#39;: 435, &#39;dropout&#39;: 0.5, &#39;lr&#39;: 6.046048370778813e-05, &#39;batch_size&#39;: 51}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:21:41,670]</span> Trial 25 finished with value: 2.302633065572926 and parameters: {&#39;vgg_b1&#39;: 327, &#39;vgg_b2&#39;: 272, &#39;vgg_b3&#39;: 450, &#39;dense&#39;: 287, &#39;dropout&#39;: 0.9, &#39;lr&#39;: 0.0009895984157195427, &#39;batch_size&#39;: 35}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:25:13,284]</span> Trial 26 finished with value: 0.9796114992436178 and parameters: {&#39;vgg_b1&#39;: 382, &#39;vgg_b2&#39;: 317, &#39;vgg_b3&#39;: 265, &#39;dense&#39;: 519, &#39;dropout&#39;: 0.30000000000000004, &#39;lr&#39;: 0.00016720140088459775, &#39;batch_size&#39;: 23}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:31:49,340]</span> Trial 27 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:33:56,756]</span> Trial 28 finished with value: 2.3033253585591025 and parameters: {&#39;vgg_b1&#39;: 195, &#39;vgg_b2&#39;: 235, &#39;vgg_b3&#39;: 379, &#39;dense&#39;: 608, &#39;dropout&#39;: 0.6, &#39;lr&#39;: 0.006701555276590694, &#39;batch_size&#39;: 42}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:39:05,950]</span> Trial 29 finished with value: 1.0034908101309177 and parameters: {&#39;vgg_b1&#39;: 301, &#39;vgg_b2&#39;: 393, &#39;vgg_b3&#39;: 471, &#39;dense&#39;: 580, &#39;dropout&#39;: 0.1, &#39;lr&#39;: 5.5809854563142486e-05, &#39;batch_size&#39;: 29}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:42:07,542]</span> Trial 30 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:47:44,125]</span> Trial 31 finished with value: 0.8815758077495073 and parameters: {&#39;vgg_b1&#39;: 231, &#39;vgg_b2&#39;: 186, &#39;vgg_b3&#39;: 208, &#39;dense&#39;: 426, &#39;dropout&#39;: 0.5, &#39;lr&#39;: 6.388393481294276e-05, &#39;batch_size&#39;: 60}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:52:07,526]</span> Trial 32 finished with value: 0.874182585053719 and parameters: {&#39;vgg_b1&#39;: 161, &#39;vgg_b2&#39;: 205, &#39;vgg_b3&#39;: 197, &#39;dense&#39;: 440, &#39;dropout&#39;: 0.5, &#39;lr&#39;: 7.930129805507095e-05, &#39;batch_size&#39;: 48}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 19:54:49,195]</span> Trial 33 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 19:58:08,657]</span> Trial 34 finished with value: 0.8615798228979111 and parameters: {&#39;vgg_b1&#39;: 129, &#39;vgg_b2&#39;: 260, &#39;vgg_b3&#39;: 244, &#39;dense&#39;: 1019, &#39;dropout&#39;: 0.6, &#39;lr&#39;: 0.00010372443791344133, &#39;batch_size&#39;: 50}. Best is trial 1 with value: 0.8538003005400426.
<span class=" -Color -Color-Green">[I 2022-01-09 20:02:53,732]</span> Trial 35 finished with value: 0.8468572935637306 and parameters: {&#39;vgg_b1&#39;: 138, &#39;vgg_b2&#39;: 141, &#39;vgg_b3&#39;: 250, &#39;dense&#39;: 852, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 9.058519215325063e-05, &#39;batch_size&#39;: 49}. Best is trial 35 with value: 0.8468572935637306.
<span class=" -Color -Color-Green">[I 2022-01-09 20:04:00,344]</span> Trial 36 finished with value: 2.3064591855887904 and parameters: {&#39;vgg_b1&#39;: 130, &#39;vgg_b2&#39;: 147, &#39;vgg_b3&#39;: 255, &#39;dense&#39;: 1016, &#39;dropout&#39;: 0.8, &#39;lr&#39;: 0.037906633402615846, &#39;batch_size&#39;: 60}. Best is trial 35 with value: 0.8468572935637306.
<span class=" -Color -Color-Green">[I 2022-01-09 20:07:30,138]</span> Trial 37 pruned. 
<span class=" -Color -Color-Green">[I 2022-01-09 20:10:06,667]</span> Trial 38 finished with value: 0.9325450231631596 and parameters: {&#39;vgg_b1&#39;: 145, &#39;vgg_b2&#39;: 152, &#39;vgg_b3&#39;: 225, &#39;dense&#39;: 916, &#39;dropout&#39;: 0.7000000000000001, &#39;lr&#39;: 0.0003701946567741201, &#39;batch_size&#39;: 83}. Best is trial 35 with value: 0.8468572935637306.
<span class=" -Color -Color-Green">[I 2022-01-09 20:12:17,309]</span> Trial 39 finished with value: 1.0199463226821985 and parameters: {&#39;vgg_b1&#39;: 130, &#39;vgg_b2&#39;: 180, &#39;vgg_b3&#39;: 274, &#39;dense&#39;: 743, &#39;dropout&#39;: 0.6, &#39;lr&#39;: 0.0006663982177439894, &#39;batch_size&#39;: 56}. Best is trial 35 with value: 0.8468572935637306.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optuna.trial</span> <span class="kn">import</span> <span class="n">TrialState</span>

<span class="n">pruned_trials</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">])</span>
<span class="n">complete_trials</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Study statistics: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Number of finished trials:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">trials</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Number of pruned trials:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pruned_trials</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Number of complete trials:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_trials</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Best trial:&quot;</span><span class="p">)</span>
<span class="n">best_trial</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_trial</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Value: &quot;</span><span class="p">,</span> <span class="n">best_trial</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Params: &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">best_trial</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Study statistics: 
  Number of finished trials:	 40
  Number of pruned trials:	 10
  Number of complete trials:	 30

Best trial:
  Value:  0.8468572935637306
  Params: 
    vgg_b1: 138
    vgg_b2: 141
    vgg_b3: 250
    dense: 852
    dropout: 0.7000000000000001
    lr: 9.058519215325063e-05
    batch_size: 49
</pre></div>
</div>
</div>
</div>
<p>Trials either early stops (gradient descent loses momentum) or gets pruned (expected to not improve even if gradient descent continues). Pruning starts after 10 trials are completed, i.e. <code class="docutils literal notranslate"><span class="pre">n_startup_trials=10</span></code>. This is so that the pruner obtains enough information about the general behavior of the gradient descent optimizer before starting to prune.</p>
<p>We set <code class="docutils literal notranslate"><span class="pre">n_warmup_steps=15</span></code> allowing each trial to train the network for 16 epochs before pruning, so that the completed trials will not be dominated by networks that descend quickly, but to shallow minimas. For example, shallow networks that possibly overfits the validation set. However, this comes at the price of wasting resources for training 16 epochs for around half of the number of trials. Finally, we set <code class="docutils literal notranslate"><span class="pre">n_min_trials=5</span></code> so that a higher number of trials at later steps can continue until it early stops or reaches max epochs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_intermediate_values</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-6">
<a class="reference internal image-reference" href="../../_images/optuna-6.png"><img alt="../../_images/optuna-6.png" src="../../_images/optuna-6.png" style="width: 685.0px; height: 464.0px;" /></a>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-7">
<a class="reference internal image-reference" href="../../_images/optuna-7.png"><img alt="../../_images/optuna-7.png" src="../../_images/optuna-7.png" style="width: 754.0px; height: 469.0px;" /></a>
</div>
<p>We can look at the distribution of best losses. Should have used a higher number of bins!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">trials_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.7/site-packages/seaborn/distributions.py:2619: FutureWarning:

`distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
</pre></div>
</div>
<img alt="../../_images/optuna_63_1.png" src="../../_images/optuna_63_1.png" />
</div>
</div>
</div>
<div class="section" id="hyperparameter-interactions">
<h3>Hyperparameter interactions<a class="headerlink" href="#hyperparameter-interactions" title="Permalink to this headline">¶</a></h3>
<p>The parallel coordinate plot below shows which combination of hyperparameters work. We can also use this to select low complexity models with similar performance to the best performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_parallel_coordinate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-8">
<a class="reference internal image-reference" href="../../_images/optuna-8.png"><img alt="../../_images/optuna-8.png" src="../../_images/optuna-8.png" style="width: 723.0px; height: 490.0px;" /></a>
</div>
<p>Slice plots can be used as guide to parameter ranges to search when making an updated study, i.e. re-running the experiment with tighter ranges.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-9">
<img alt="../../_images/optuna-9.png" src="../../_images/optuna-9.png" />
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-10">
<a class="reference internal image-reference" href="../../_images/optuna-10.png"><img alt="../../_images/optuna-10.png" src="../../_images/optuna-10.png" style="width: 746.0px; height: 456.0px;" /></a>
</div>
<p>Turns out a low learning rate works for any size of the first VGG block and batch size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="s1">&#39;vgg_b1&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-11">
<img alt="../../_images/optuna-11.png" src="../../_images/optuna-11.png" />
</div>
<p>For the bottom part of the network, a large width for the fully-connected block seems to work well. Meanwhile the size of the 3rd VGG block seem to be multimodal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;vgg_b3&#39;</span><span class="p">,</span> <span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="s1">&#39;dropout&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="optuna-12">
<img alt="../../_images/optuna-12.png" src="../../_images/optuna-12.png" />
</div>
</div>
</div>
<div class="section" id="appendix-hyperparameters-of-commonly-used-models">
<h2>Appendix: Hyperparameters of commonly used models<a class="headerlink" href="#appendix-hyperparameters-of-commonly-used-models" title="Permalink to this headline">¶</a></h2>
<br><div class="figure align-default" id="hyp">
<img alt="../../_images/hyp.png" src="../../_images/hyp.png" />
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Table from p. 184 of <span id="id7">[<a class="reference internal" href="../../intro.html#id10">Tha20</a>]</span>. <strong>RS</strong><span class="math notranslate nohighlight">\(^*\)</span> implies random search should be better.</span><a class="headerlink" href="#hyp" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="xgboost-parameter-space">
<h3>XGBoost parameter space<a class="headerlink" href="#xgboost-parameter-space" title="Permalink to this headline">¶</a></h3>
<p>The following search space is used to tune XGBoost in the <a class="reference external" href="https://github.com/abhishekkrthakur/autoxgb">autoxgb</a> package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#https://github.com/abhishekkrthakur/autoxgb/blob/main/src/autoxgb/params.py</span>
<span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">model_config</span><span class="p">):</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;reg_lambda&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;reg_lambda&quot;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;reg_alpha&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;reg_alpha&quot;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;subsample&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;subsample&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">&quot;colsample_bytree&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;colsample_bytree&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;max_depth&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s2">&quot;early_stopping_rounds&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;early_stopping_rounds&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
        <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">]),</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="n">model_config</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tree_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gpu_hist&quot;</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;gpu_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;predictor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gpu_predictor&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tree_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s2">&quot;tree_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="s2">&quot;approx&quot;</span><span class="p">,</span> <span class="s2">&quot;hist&quot;</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;booster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s2">&quot;booster&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;gbtree&quot;</span><span class="p">,</span> <span class="s2">&quot;gblinear&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;booster&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gbtree&quot;</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;grow_policy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s2">&quot;grow_policy&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;depthwise&quot;</span><span class="p">,</span> <span class="s2">&quot;lossguide&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">params</span>
</pre></div>
</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="ref4"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>See <a class="reference external" href="https://github.com/optuna/optuna-dashboard">Optuna dashboard</a> which displays the same plots that are updated in real-time.</p>
</dd>
<dt class="label" id="ref3"><span class="brackets"><a class="fn-backref" href="#id6">2</a></span></dt>
<dd><p>In practice, we save the best model parameters at this point.</p>
</dd>
</dl>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/fundamentals"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="blending-stacking.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Blending and Stacking</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="missing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Handling Missing Values</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By 𝗥𝗼𝗻 𝗠𝗲𝗱𝗶𝗻𝗮. Powered by <a href="https://jupyterbook.org">Jupyter Book</a>.<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>